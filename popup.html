<!Doctype html>
<html lang="es" class="no-js">
	<head>
		<script></script>
		<meta charset="utf-8">
		<title>MercadoLobre Seeker</title>
		<link rel="stylesheet" href="src/css/normalize.css">
		<link rel="stylesheet" href="src/css/chico-mobile.css">
	</head>
	<body>	
	
		<header class="ch-header">
			<h1 class="ch-logo">
				<img alt="MercadoLibre" src="src/assets/logo.png" />
			</h1>
			
			<form class="ch-form ch-header-form" action="./" method="GET" role="search">
				<input type="text" id="query" class="search" maxlength="60" name="q" autocomplete="off" placeholder="Busca en MercadoLibre...">
				<!--input type="submit" value="Buscar" accesskey="b" class="icon-search"-->
				<a href="#" title="Buscar" class="ch-icon-search"></a>
			</form>

			<menu>
				<li class="ch-nav"><a class="ch-icon-list" href="#navigation"><span>Men√∫</span></a></li>
			</menu>
			<nav id="navigation" class="ch-hide" role="navigation"></nav>

		</header>

		<section id="results"></section>

		<!-- Templates -->
		<script type="text/template" id="tpl-site">
			<li><a href="#<%= id %>" data-id="<%= id %>"><%= name %></a></li>
		</script>
		<script type="text/template" id="tpl-item">
			<a href="<%= permalink %>">
				<img src="<%= thumbnail %>" alt="<%= title %>" width="90" height="90"/>
				<h2><%= title %></h2>
				<p><%= address.state_name %></p>
				<p class="ch-price"><%= currency_id %> <%= price %></p>
			</a>
		</script>
		<script src="vendor/jquery.js"></script>
		<script src="vendor/underscore.js"></script>
		<script src="vendor/backbone.js"></script>
		<script src="vendor/chico-mobile.js"></script>

		<script src="src/js/app.js"></script>
		<!--script>
			console.log(chrome.cookies.get({
				"name": "orgid",
				"url": "http://www.mercadolibre.com.ar"
			}, function (c) {
				console.log("https://api.mercadolibre.com/users/me/bookmarks?access_token=" + c.value);
			}));
		</script-->
		
		<!--script type="text/javascript">
		(function (window, undefined) {

			var app = (function() {

				var limit = 15,

					search = {
						offset: 0,
						site: "MLA",
						looking: function (query, offset, site) {
							var offset = (offset == 0) ? offset : (search.offset += limit);
							var site = (site != undefined) ? site : search.site;
							$.getJSON("https://api.mercadolibre.com/sites/" + site +"/search?offset=" + offset + "&limit=" + limit + "&q=" + escape(query) + "&callback=?", search.parseResults);
						},

						parseResults: function (data) {
							var items = [];
							$(data[2].results).each(function (i,e) {

								var title = "<header><a href=\"" + e.permalink + "\">" + e.title + "</a></header>";

								var thumb = "<figure><img src=\"" + e.thumbnail + "\" width=\"90\" height=\"90\"></figure>";

								var price = "<p class=\"costs\"><span class=\"price\">" + ((e.currency_id == "USD") ? "U$S " : "$ ") + e.price + "</span></p>";

								var row = "<li><article>" + title + thumb + price + "</article></li>";

								items.push(row);

							});

							var html = items.join("");

							$(".loading").remove();

							$("#searchResults").append(html);

							if ($(".more").length != 0) {
								return;
							};

							$(".example").append("<p class=\"actions\"><input type=\"submit\" value=\"More\" class=\"btn secondary skin more\"><p>");
						}
					};

				return search;

			})();

			window.app = app;

		}(window));

		var init = function (event, offset) {
			event.preventDefault();
			event.stopPropagation();
			$(".actions").remove();
			app.looking($(".search").val(), offset,  $("#site").val());
		};

		$("#formBusqueda").bind("submit", function(event){
			$("#searchResults").html("<div class=\"loading\">");
			init(event, 0);
		});

		$(".more").live("click", function(event){
			$("#searchResults").append("<div class=\"loading small\">");
			init(event);
		});

		$("#searchResults").bind("click", function(event){
			event = event || window.event;
			var target = event.target || event.srcElement;
			
			if (target.tagName == "A") {
				chrome.tabs.getSelected(null, function(tab) {
					chrome.tabs.update(tab.id, {"url":target.href});
				});
			};
		});

		</script-->
	</body>
</html>